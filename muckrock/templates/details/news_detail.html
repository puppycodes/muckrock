{% extends 'details/base_detail.html' %}
{% load markdown_deux_tags %}
{% load thumbnail %}
{% load static from staticfiles %}
{% load thumbnail %}
{% load tags %}

{% with object as article %}

{% block title %}MuckRock &bull; {{ article.title }}{% endblock title %}

{% block content %}
<div class="news detail">
    <article class="news-article">
        <header class="news-article-header">
            {% if article.image %}
            <img src="{% thumbnail article.image 1200x400 crop %}" class="news-image">
            {% endif %}
            <h1 class="news-article-title">{{ article.title }}</h1>
            {% if article.kicker %}
            <summary class="news-article-kicker">{{ article.kicker }}</summary>
            {% endif %}
            <div class="secondary">
                <div class="news-article-authors">by
                    {% for author in article.authors.all %}
                        <a href="{{ author.profile.get_absolute_url }}" title="{{ author.get_full_name }}">{{ author.get_full_name }}</a>
                        {% if not forloop.last %}, {% endif %}
                    {% endfor %}
                </div>
                <time datetime="{{ article.pub_date }}" class="news-article-date">{{ article.pub_date | date:"F j, Y" }}</time>
            </div>
        </header>
        <section class="news-article-body">
        {% with article.body|markdown:"trusted" as copy %}
            {% evaluate copy %}
        {% endwith %}
        </section>
        <aside class="news-aside">
            {% include 'lib/social.html' with title=article.title %}
            {% tag_manager article %}
        </aside>
        <footer class="news-article-footer">
        {% if article.foias.exists %}
            <dfn>Related Requests</dfn>
            {% include 'lib/foia_group.html' with foias=article.foias.all %}
        {% endif %}
        </footer>
    </article>

</div>
{% endblock %}

{% block open_graph %}
<meta property="og:title" content="{{ article.title }}" />
<meta property="og:type" content="article" />
<meta property="og:url" content="{{ request.build_absolute_uri }}" />
{% if article.image %}
<meta property="og:image" content="{% thumbnail article.image 1200x400 %}" />
{% else %}
<meta property="og:image" content="{% static 'apple-touch-icon.png' %}" />
{% endif %}
<meta property="og:description" content="{{ article.summary }}" />
<meta property="og:site_name" content="MuckRock" />
<meta property="og:article:published_time" content="{{ article.date }}" />
{% endblock open_graph %}

{% block twitter_card %}
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:site" content="@muckrock" />
{% with article.authors.all|first as author %}
    {% if author.profile.twitter %}
<meta name="twitter:creator" content="{{ author.profile.twitter }}" />
    {% endif %}
{% endwith %}
<meta name="twitter:title" content="{{ article.title }}" />
<meta name="twitter:description" content="{{ article.summary }}" />
{% if article.image %}
<meta name="twitter:image:src" content="{% thumbnail article.image 1200x400 %}" />
{% else %}
<meta name="twitter:image:src" content="{% static 'apple-touch-icon.png' %}" />
{% endif %}
{% endblock twitter_card %}

{% endwith %}

{% block scripts %}
{% include 'autocomplete_light/static.html' %}
<script src="{% static 'js/jquery.fitvids.js' %}" type="text/javascript"></script>
<script src="{% static 'js/autoNumeric.js' %}" type="text/javascript"></script>
<script type="text/javascript" src="{% static 'js/crowdfund.js' %}"></script>
<script src="https://checkout.stripe.com/checkout.js" type="text/javascript"></script>
<script src="https://s3.amazonaws.com/s3.documentcloud.org/viewer/loader.js" type="text/javascript"></script>
<script type="text/javascript">
$('.checkout-button').click(function(e){
    e.preventDefault();
    var checkoutData = getCheckoutData($(this));
    checkout(
        "{{ stripe_pk }}",
        "{% static 'apple-touch-icon.png' %}",
        checkoutData.description,
        checkoutData.amount,
        checkoutData.email,
        checkoutData.label,
        checkoutData.form
    );
    return false;
});
</script>
{% endblock scripts %}
